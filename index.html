
<!DOCTYPE HTML>
<html>
<head>
	<script data-cfasync="false" type="text/javascript" src="//use.typekit.net/axj3cfp.js"></script>
	<script data-cfasync="false" type="text/javascript">try{Typekit.load();}catch(e){}</script>
	<meta charset="utf-8">
	<title>Code, Thoughts And Ideas  | El Chavo</title>

<meta name="author" content="El Chavo">

<meta name="description" content="With the recent addition of Atlas to the Hashicorp
arsenal, Vagrant got an update to be integrated into Atlas for hosting your
VM boxes and handling &hellip;"> <meta name="keywords" content="">

	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="atom.xml" rel="alternate" title="El Chavo" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/bootstrap.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/font-awesome.min.css" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script type="text/javascript" src="/javascripts/jquery.fancybox.pack.js"></script>

<script language="Javascript" type="text/javascript">
$(document).ready(
  function() {
    (function($) {
      $(".fancybox[data-content-id]").each(function() {
        this.href = $(this).data('content-id');
      });
      $(".fancybox").fancybox({
        beforeLoad: function() {
          var el, 
              id = $(this.element).data('title-id');

          if (id) {
            el = $('#' + id);

            if (el.length) {
              this.title = el.html();
            }
          }
          if ($(this).data('content')) {
            this.content = $(this).data('content');
          }
        },
        helpers: {
          title: {
            type: 'inside'
          }
        }
      });
    })(jQuery);
  }
);
</script>

	<link rel="stylesheet" href="/stylesheets/styles/solarized_dark.css">

</head>



<body>
	<header id="header" class="inner"><h1><a href="/">El Chavo</a></h1>
<h4>Code, Thoughts And Ideas</h4>
<nav id="main-nav"><ul>
	<li><a class="active" href="/">Blog</a></li>
	<li><a class="" href="/about">About</a></li>
  <li><a class="" href="/projects">Projects</a></li>
	<li><a class="" href="/archives">Archive</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul>
	<li><a class="active" href="/">Blog</a></li>
	<li><a class="" href="/about">About</a></li>
  <li><a class="" href="/projects">Projects</a></li>
	<li><a class="" href="/archives">Archive</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="https://www.google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:blog.el-chavez.me">
			</form>
		</div>
	</div>
</nav>


</header>

	<div id="content" class="inner">


    <article class="post">
	<h2 class="title">
		
		<a href="/2015/01/31/custom-vagrant-cloud-host/">
		
			Custom Vagrant Cloud Versioned Box Host</a>
	</h2>
	<div class="entry-content">
		<p>With the recent addition of <a href="https://atlas.hashicorp.com">Atlas</a> to the <a href="https://hashicorp.com">Hashicorp</a>
arsenal, <a href="https://www.vagrantup.com">Vagrant</a> got an update to be integrated into Atlas for hosting your
VM boxes and handling versioned updates. If you are still looking to have your boxes versioned
and are hosting them yourself, or your company has them private, you can still achieve versioning
your boxes with the latest Vagrant (1.7.2) and some manual work. In this post I will go through:</p>

<blockquote>
  <ol>
    <li>Basics of building a Virtualbox Vagrant box, just enough to follow along.</li>
    <li>Building a box metadata file, used to resolve box versions and download URLs.</li>
    <li>Hooking everything up with your Vagrantfile.</li>
  </ol>
</blockquote>

<h2 id="building-a-box">Building a Box</h2>

<p>If this topic is new to you please review <a href="https://docs.vagrantup.com/v2/boxes/base.html">the docs</a>, as this is not a new part
of vagrant and is provider specific. For simplicity we will use <a href="https://www.virtualbox.org/">VirtualBox</a>
in these examples.</p>

<p>Please make sure you have the most recent Vagrant (1.7.2) and VirtualBox (4.3.20) beforehand.
We will need a basic <code>Vagrantfile</code> to start out with, or you can use one of your own.</p>

<div class="highlight"><pre><code class="ruby"><span class="c1"># -*- mode: ruby -*-</span>
<span class="c1"># vi: set ft=ruby :</span>

<span class="c1"># Vagrantfile API/syntax version. Don&#39;t touch unless you know what you&#39;re doing!</span>
<span class="no">VAGRANTFILE_API_VERSION</span> <span class="o">=</span> <span class="s1">&#39;2&#39;</span>

<span class="no">Vagrant</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="no">VAGRANTFILE_API_VERSION</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="c1"># Base box from Atlas</span>
  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s1">&#39;ubuntu/trusty64&#39;</span>

  <span class="c1"># Virtualbox VM settings</span>
  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provider</span> <span class="ss">:virtualbox</span> <span class="k">do</span> <span class="o">|</span><span class="n">v</span><span class="o">|</span>
    <span class="n">v</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;custom-box&#39;</span>
    <span class="n">v</span><span class="o">.</span><span class="n">cpus</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">v</span><span class="o">.</span><span class="n">memory</span> <span class="o">=</span> <span class="mi">4096</span>
    <span class="n">opts</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;modifyvm&#39;</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s1">&#39;--natdnshostresolver1&#39;</span><span class="p">,</span> <span class="s1">&#39;on&#39;</span><span class="o">]</span>
    <span class="n">v</span><span class="o">.</span><span class="n">customize</span> <span class="n">opts</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<p>This setup gives us an Ubuntu 64-bit Trusty box which will be pulled from Atlas to
build our VM. Worth noting is the name of our VM in Virtualbox is set to <code>custom-box</code>.
First we need to bring up the VM so it gets created if it hasn’t already been.</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>vagrant up --provider virutalbox</code></pre></div>

<p>Now we can use Vagrant’s built in tool to build a box from the Virutalbox VM we just created.
In your terminal go to the directory of your project where your <code>Vagrantfile</code> is and run the
command to build the box.</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>vagrant package --base custom-box --output custom-box-0.0.1.box</code></pre></div>

<p>This may take some time depending on if you have provisioned your box with anything extra.
The comman is telling Vagrant to package our box using our Vagrantfile. It will look up a VM
in Virutalbox named <code>custom-box</code> and we are naming our box <code>custom-box-0.0.1</code>. If this succeeds
you should see a box in your directory named <code>custom-box-0.0.1.box</code>.</p>

<p>This box file will need to be hosted somewhere so we can point to it in our box manifest file for
each version of the box. For the rest of the examples I will assume it is hosted on <code>example.com</code>.</p>

<h2 id="box-metadata-json">Box Metadata JSON</h2>

<p>Vagrant, and Vagrant Cloud, uses a <code>metadata.json</code> file to determine where to download the box, the
versions available for a box and what providers the box is valid for. We will need to manage this
file in order to host our own versioned boxes outside of Vagrant Cloud. Here is an example
metadata file:</p>

<div class="highlight"><pre><code class="json"><span class="p">{</span>
    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;custom-box&quot;</span><span class="p">,</span>
    <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;My Custom Ubuntu 14.04 64-bit Box&quot;</span><span class="p">,</span>
    <span class="nt">&quot;versions&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;0.0.1&quot;</span><span class="p">,</span>
            <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;active&quot;</span><span class="p">,</span>
            <span class="nt">&quot;providers&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;virtualbox&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://example.com/vagrant/boxes/custom-box-0.0.1.box&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;checksum_type&quot;</span><span class="p">:</span> <span class="s2">&quot;sha256&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;checksum&quot;</span><span class="p">:</span> <span class="s2">&quot;d955cka5ce671de0be9846956a8954796e8ac42e5166847429951a7301fb7d42&quot;</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span></code></pre></div>

<p>This example is defining a box which we have named <code>cusom-box</code>. This is equivalent to the
base ubuntu box we used which was named <code>ubuntu/trusty64</code>. This could be named a little better
such as scoped by project or company ie. <code>project-foo/trusty64</code>, <code>company-bar/api-box</code>. This box
has a description and then an array of all versions for the box.</p>

<p>The versions are where everything is really defined. Each version is a hash that contains: a version number,
a status, and an array of providers with information on each box specific to the provider. Since we are
using Virtualbox only we just have a single entry here with the URL of our box and a checksum to apply to
the download for verification. If we wanted to add extra versions it is as simple as adding another dictionary to our versions list, with
all the details filled out of course.</p>

<p>This file needs to be hosted somewhere as well so we will assume it is on our <code>example.com</code>
domain. Once you have your box and metadata file hosted we can now tie this all together with our
Vagrantfile.</p>

<h2 id="hooking-everything-up">Hooking Everything Up</h2>

<p>Firs we need to update our <code>Vagrantfile</code> so that it knows about our new versioned box we
are hosting outside of Atlas.</p>

<div class="highlight"><pre><code class="ruby"><span class="c1"># -*- mode: ruby -*-</span>
<span class="c1"># vi: set ft=ruby :</span>

<span class="c1"># Vagrantfile API/syntax version. Don&#39;t touch unless you know what you&#39;re doing!</span>
<span class="no">VAGRANTFILE_API_VERSION</span> <span class="o">=</span> <span class="s1">&#39;2&#39;</span>

<span class="no">Vagrant</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="no">VAGRANTFILE_API_VERSION</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s1">&#39;custom-box&#39;</span>
  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box_version</span> <span class="o">=</span> <span class="s1">&#39;0.0.1&#39;</span>
  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box_url</span> <span class="o">=</span> <span class="s1">&#39;http://example.com/vagrant/boxes/custom/metadata.json&#39;</span>

  <span class="c1"># Virtualbox VM settings</span>
  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provider</span> <span class="ss">:virtualbox</span> <span class="k">do</span> <span class="o">|</span><span class="n">v</span><span class="o">|</span>
    <span class="n">v</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;custom-box&#39;</span>
    <span class="n">v</span><span class="o">.</span><span class="n">cpus</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">v</span><span class="o">.</span><span class="n">memory</span> <span class="o">=</span> <span class="mi">4096</span>
    <span class="n">opts</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;modifyvm&#39;</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s1">&#39;--natdnshostresolver1&#39;</span><span class="p">,</span> <span class="s1">&#39;on&#39;</span><span class="o">]</span>
    <span class="n">v</span><span class="o">.</span><span class="n">customize</span> <span class="n">opts</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<p>The changes to note here is we are using the name of our box now instead of the ubuntu name, <code>custom-box</code>.
We also have added a <code>config.vm.box_url</code> pointing to our hosted box metadata file and the version
we want to use is set with <code>config.vm.box_version</code>.</p>

<p>What is happening here for this to work is Vagrant pulls the metadata file down and checks what boxes it
knows about and matches that to what you have defined in your <code>Vagrantfile</code>. If everything is set up correctly
we should be able to do a <code>vagrant up</code>, ensuring the VM is already halted. This should pull the new box
down from the url for the version and provider defined in the metadata file. Now you have your own
custom hosted and versioned Vagrant box outside of Atlas.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








<time datetime="Jan 31, 2015" pubdate data-updated="true">Jan 31, 2015</time>


</div>
	

<div class="tags">

	<a class='category' href='/categories/custom-vagrant-cloud-host/'>custom vagrant cloud host</a>, <a class='category' href='/categories/vagrant/'>vagrant</a>, <a class='category' href='/categories/vagrant-box-version/'>vagrant box version</a>, <a class='category' href='/categories/vagrant-cloud/'>vagrant cloud</a>

</div>


	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2013/08/29/golang-documenting-package-examples/">
		
			Golang Documenting Package Examples</a>
	</h2>
	<div class="entry-content">
		<p><a href="http://golang.org/">Go</a> has been gaining a lot of popularity recently. With a
lot of the success stories centered on the performance gains switching from
other languages. For me a lot of the smaller features, that shows an attention
to detail, which makes it enjoyable to code in. These details are also what
will help the Golang community grow as well. One of these details is the built
in documentation into the language.</p>

<p>There is a built in <code>go doc</code> command with the language where you can view your
package documentation locally by running an http server to serve your docs.
<a href="http://godoc.org/">GoDoc</a> is the main hosting for open source packages that
will build docs for your package by doing a <code>go get</code> and generating docs.
Locally you can run <code>go doc</code> from your package to display the docs in your
terminal.</p>

<div class="highlight"><pre><code class="go"><span class="err">$</span> <span class="nx">cd</span> <span class="err">$</span><span class="nx">GOPATH</span><span class="o">/</span><span class="nx">src</span><span class="o">/</span><span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">mtchavez</span><span class="o">/</span><span class="k">go</span><span class="o">-</span><span class="nx">statsite</span><span class="o">/</span><span class="nx">statsite</span>
<span class="err">$</span> <span class="k">go</span> <span class="nx">doc</span>
<span class="nx">PACKAGE</span> <span class="nx">DOCUMENTATION</span>

<span class="kn">package</span> <span class="nx">statsite</span>
    <span class="kn">import</span> <span class="s">&quot;github.com/mtchavez/go-statsite/statsite&quot;</span>



<span class="nx">VARIABLES</span>

<span class="kd">var</span> <span class="nx">MTypes</span> <span class="p">[]</span><span class="kt">string</span> <span class="p">=</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span>
    <span class="s">&quot;kv&quot;</span><span class="p">,</span>
    <span class="s">&quot;g&quot;</span><span class="p">,</span>
    <span class="s">&quot;ms&quot;</span><span class="p">,</span>
    <span class="s">&quot;c&quot;</span><span class="p">,</span>
    <span class="s">&quot;s&quot;</span><span class="p">,</span>
<span class="p">}</span>


<span class="nx">TYPES</span>

<span class="kd">type</span> <span class="nx">Client</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">Conn</span> <span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span>
    <span class="c1">// contains filtered or unexported fields</span>
<span class="p">}</span>


<span class="kd">func</span> <span class="nx">NewClient</span><span class="p">(</span><span class="nx">addr</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="nx">client</span> <span class="o">*</span><span class="nx">Client</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span>


<span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Client</span><span class="p">)</span> <span class="nx">Emit</span><span class="p">(</span><span class="nx">m</span> <span class="nx">Messenger</span><span class="p">)</span> <span class="p">(</span><span class="kt">bool</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Client</span><span class="p">)</span> <span class="nx">Emitter</span><span class="p">(</span><span class="nx">msg</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="nx">ok</span> <span class="kt">bool</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span></code></pre></div>

<p>Or you can view all the packages in your <code>$GOSRC</code> directory as well as the
standard library code in your browser by running <code>godoc -http=:6060</code>. Then
visit <code>localhost:6060</code> in your browser. This looks the same as golang.org you
may notice. Click on <code>Packages</code> and find the package you are looking for. This
all comes built into the language itself.</p>

<p>If you have spent any time using go, browsed the standard library docs, used
an open source go project you may have notice a <code>Examples</code> in docs. These
examples are one of the details I mentioned that add to the language and help
grow a community. <a href="http://golang.org/pkg/time/#pkg-examples">Here</a> is an
example of the built in <code>time</code> package examples. The novel thing about this is
it is just the built in examples from the Go source that get generated by <code>go
doc</code> from the language itself. There is no extra documentation package or
custom manages site.</p>

<p>So you have an open source project, or some internal go project, that you want
to make life easier for others to pick up and understand. Lets write an
example for them to understand how to use your package. Lets say you have a
fibonacci number generator package. And you want to show someone how to use it
with an example. Lets add a <code>$GOPATH/src/fib</code> directory with a <code>fib.go</code> main
package with the following:</p>

<div class="highlight"><pre><code class="go"><span class="kn">package</span> <span class="nx">fib</span>

<span class="kn">import</span> <span class="p">(</span>
  <span class="s">&quot;fmt&quot;</span>
  <span class="s">&quot;os&quot;</span>
  <span class="s">&quot;strconv&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">fib</span><span class="p">(</span><span class="nx">n</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
  <span class="k">if</span> <span class="nx">n</span> <span class="p">&lt;</span> <span class="mi">2</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">n</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">fib</span><span class="p">(</span><span class="nx">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="nx">fib</span><span class="p">(</span><span class="nx">n</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
<span class="p">}</span></code></pre></div>

<p>Since we’ll be expecting others to use our package we’ll want to test it works
as well as document how to use it. With examples we can do both in one shot.
In our same <code>$GOPATH/src/fib</code> directory create a <code>fib_test.go</code> file. Lets add
our example test.</p>

<div class="highlight"><pre><code class="go"><span class="kn">package</span> <span class="nx">fib</span>

<span class="kn">import</span> <span class="p">(</span>
  <span class="s">&quot;fmt&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">Example</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">output</span> <span class="kt">int</span>
  <span class="nx">output</span> <span class="p">=</span> <span class="nx">fib</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
  <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Fibonacci of %v is %v\n&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="nx">output</span><span class="p">)</span>
  <span class="nx">output</span> <span class="p">=</span> <span class="nx">fib</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
  <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Fibonacci of %v is %v\n&quot;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="nx">output</span><span class="p">)</span>
  <span class="c1">// Output:</span>
  <span class="c1">// Fibonnacci of 10 is 55</span>
  <span class="c1">// Fibonnacci of 20 is 6765</span>
<span class="p">}</span></code></pre></div>

<p>Now from your <code>fib/</code> directory run <code>go test</code> and you should see some similar
output:</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>go <span class="nb">test</span>
PASS
ok    fib 0.023s</code></pre></div>

<p>This allowed us to both test our fibonacci package and show someone else an
example how to use it. If the output changed or we broke our package our tests
should fail as well.</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>go <span class="nb">test</span>
--- FAIL: Example <span class="o">(</span>80.68us<span class="o">)</span>
got:
Fibonacci of 10 is 55
Fibonacci of 20 is 6765
want:
Fibonacci of 10 is 55
Fibonacci of 20 is 55
FAIL
<span class="nb">exit </span>status 1
FAIL  fib 0.018s</code></pre></div>

<p>Simple enough. What if you have a struct where you are calling a function off
of and want to show how one would use the function. The principal is the same
except we change our <code>Example()</code> function name in our test. If we change our
<code>fib.go</code> to this:</p>

<div class="highlight"><pre><code class="go"><span class="kn">package</span> <span class="nx">fib</span>

<span class="kn">import</span> <span class="p">(</span>
  <span class="s">&quot;fmt&quot;</span>
  <span class="s">&quot;os&quot;</span>
  <span class="s">&quot;strconv&quot;</span>
<span class="p">)</span>

<span class="kd">type</span> <span class="nx">FibStruct</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="nx">num</span>    <span class="kt">int</span>
  <span class="nx">result</span> <span class="kt">int</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">fib</span><span class="p">(</span><span class="nx">n</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
  <span class="k">if</span> <span class="nx">n</span> <span class="p">&lt;</span> <span class="mi">2</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">n</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">fib</span><span class="p">(</span><span class="nx">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="nx">fib</span><span class="p">(</span><span class="nx">n</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">f</span> <span class="o">*</span><span class="nx">FibStruct</span><span class="p">)</span> <span class="nx">Calculate</span><span class="p">(</span><span class="nx">num</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">f</span><span class="p">.</span><span class="nx">num</span> <span class="p">=</span> <span class="nx">num</span>
  <span class="nx">f</span><span class="p">.</span><span class="nx">result</span> <span class="p">=</span> <span class="nx">fib</span><span class="p">(</span><span class="nx">num</span><span class="p">)</span>
<span class="p">}</span></code></pre></div>

<p>Then we can add an example on how to use our new <code>Calculate()</code> method in
<code>fib_test.go</code>.</p>

<div class="highlight"><pre><code class="go"><span class="kd">func</span> <span class="nx">ExampleFibStruct_Calculate</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">f</span> <span class="o">:=</span> <span class="nx">FibStruct</span><span class="p">{}</span>
  <span class="nx">f</span><span class="p">.</span><span class="nx">Calculate</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
  <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Fibonacci of %v is %v\n&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="nx">f</span><span class="p">.</span><span class="nx">result</span><span class="p">)</span>

  <span class="nx">f</span><span class="p">.</span><span class="nx">Calculate</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
  <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Fibonacci of %v is %v\n&quot;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="nx">f</span><span class="p">.</span><span class="nx">result</span><span class="p">)</span>
  <span class="c1">// Output:</span>
  <span class="c1">// Fibonacci of 10 is 55</span>
  <span class="c1">// Fibonacci of 20 is 6765</span>
<span class="p">}</span></code></pre></div>

<p>Running the tests again with <code>go test</code> should show everything passing. Last
part to this is viewing your examples via <code>go doc</code> or on
<a href="http://godoc.org">GoDoc</a>. You can view this example at <a href="http://godoc.org/github.com/mtchavez/fib-go-example">fib-go-
example</a>.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








<time datetime="Aug 29, 2013" pubdate data-updated="true">Aug 29, 2013</time>


</div>
	

<div class="tags">

	<a class='category' href='/categories/go/'>go</a>, <a class='category' href='/categories/golang/'>golang</a>, <a class='category' href='/categories/golang-documentation/'>golang documentation</a>, <a class='category' href='/categories/golang-examples/'>golang examples</a>

</div>


	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2013/08/09/golang-timed-function-wrapper/">
		
			Golang Timed Function Wrapper</a>
	</h2>
	<div class="entry-content">
		<p>Wrote this quick and probably dirty wrapper for timing functions in Go.
<code>TimedReturn</code> returns an <code>interface{}</code> in case a return value is needed
from whatever you are wrapping.</p>

<div class="highlight"><pre><code class="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
  <span class="s">&quot;fmt&quot;</span>
  <span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="kd">type</span> <span class="nx">wrapped</span> <span class="kd">func</span><span class="p">()</span>
<span class="kd">type</span> <span class="nx">wrappedReturn</span> <span class="kd">func</span><span class="p">()</span> <span class="kd">interface</span><span class="p">{}</span>

<span class="kd">func</span> <span class="nx">Timed</span><span class="p">(</span><span class="nx">fn</span> <span class="nx">wrapped</span><span class="p">,</span> <span class="nx">key</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">start</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">Unix</span><span class="p">()</span>
  <span class="nx">fn</span><span class="p">()</span>
  <span class="nx">end</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">Unix</span><span class="p">()</span>
  <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Time: %d, Key: %s\n&quot;</span><span class="p">,</span> <span class="nx">end</span><span class="o">-</span><span class="nx">start</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">TimedReturn</span><span class="p">(</span><span class="nx">fn</span> <span class="nx">wrappedReturn</span><span class="p">,</span> <span class="nx">key</span> <span class="kt">string</span><span class="p">)</span> <span class="kd">interface</span><span class="p">{}</span> <span class="p">{</span>
  <span class="nx">start</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">Unix</span><span class="p">()</span>
  <span class="nx">resp</span> <span class="o">:=</span> <span class="nx">fn</span><span class="p">()</span>
  <span class="nx">end</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">Unix</span><span class="p">()</span>
  <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Time: %d, Key: %s]n&quot;</span><span class="p">,</span> <span class="nx">end</span><span class="o">-</span><span class="nx">start</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span>
  <span class="k">return</span> <span class="nx">resp</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">fn</span> <span class="o">:=</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Hello from wrapped function!&quot;</span><span class="p">)</span>
    <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="nx">Timed</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="s">&quot;go.playground&quot;</span><span class="p">)</span>

  <span class="nx">fn2</span> <span class="o">:=</span> <span class="kd">func</span><span class="p">()</span> <span class="kd">interface</span><span class="p">{}</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Hello from wrapped function with return!&quot;</span><span class="p">)</span>
    <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">3</span><span class="p">}</span>
  <span class="p">}</span>
  <span class="nx">returned</span> <span class="o">:=</span> <span class="nx">TimedReturn</span><span class="p">(</span><span class="nx">fn2</span><span class="p">,</span> <span class="s">&quot;go.playground&quot;</span><span class="p">)</span>
  <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;TimedReturn got:&quot;</span><span class="p">,</span> <span class="nx">returned</span><span class="p">.([]</span><span class="kt">int</span><span class="p">))</span>
<span class="p">}</span></code></pre></div>


		
		
	</div>


<div class="meta">
	<div class="date">








<time datetime="Aug 9, 2013" pubdate data-updated="true">Aug 9, 2013</time>


</div>
	


	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2013/06/04/golang-package-version-flag/">
		
			Golang Package Version Flag</a>
	</h2>
	<div class="entry-content">
		<p>So you’ve built your first service using Go and have it deployed out into your
production environment. With cross compiling built into Go it’s easy and almost
trivial to build a new binary of your code and deploy updates. But what happens
when you need to know what version of your code is where or how can you easily
verify your new binary was deployed.</p>

<p>There is a built in library in Go that handles flag parsing, the flag package.
Using the flag package is straight forward and allows us to use flags to pass
to our binary to print a version out.</p>

<p>First lets start with a main package that imports the flag package.</p>

<div class="highlight"><pre><code class="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;flag&quot;</span>
    <span class="s">&quot;fmt&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">flag</span><span class="p">.</span><span class="nx">Parse</span><span class="p">()</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Hello from main()&quot;</span><span class="p">)</span>
<span class="p">}</span></code></pre></div>

<p>If you have the file in your $GOROOT as main.go then run <code>go build main.go</code>
and after running <code>./main</code> you should see:</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>./main
Hello from main<span class="o">()</span></code></pre></div>

<p>So what did the <code>flag.Parse()</code> line do for us? Well it actually looked to
parse any flags passed to the program. Since we did not pass anything it does
not have to do any work here. Now lets add a version flag to parse so we can
print the version of our program.</p>

<div class="highlight"><pre><code class="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;flag&quot;</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;os&quot;</span>
<span class="p">)</span>

<span class="kd">const</span> <span class="nx">AppVersion</span> <span class="p">=</span> <span class="s">&quot;1.0.0 beta&quot;</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">version</span> <span class="o">:=</span> <span class="nx">flag</span><span class="p">.</span><span class="nx">Bool</span><span class="p">(</span><span class="s">&quot;v&quot;</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="s">&quot;prints current app version&quot;</span><span class="p">)</span>
    <span class="nx">flag</span><span class="p">.</span><span class="nx">Parse</span><span class="p">()</span>
    <span class="k">if</span> <span class="o">*</span><span class="nx">version</span> <span class="p">{</span>
      <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">AppVersion</span><span class="p">)</span>
      <span class="nx">os</span><span class="p">.</span><span class="nx">Exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Hello from main()&quot;</span><span class="p">)</span>
<span class="p">}</span></code></pre></div>

<p>We first start by adding a definition of our version flag. It will be a boolean
flag with a name of v, a default of false and a description of what our flag means.
Next we call <code>flag.Parse()</code> to look for any flags passed into our program.
After parsing our version variable will have a value if we passed a <code>-v</code> to our
program when running it. Run your program again, this time passing in our <code>-v</code>
flag, and you should see the version string printed out and the program exist.</p>

<p>Some things to try out:</p>

<ul>
  <li>What happens if you don’t pass in the <code>-v</code> flag?</li>
  <li>What is the difference if you change the default value for the flag from false to true?</li>
  <li>If you pass a flag other than <code>-v</code> what is the output of the program?</li>
</ul>

		
		
	</div>


<div class="meta">
	<div class="date">








<time datetime="Jun 4, 2013" pubdate data-updated="true">Jun 4, 2013</time>


</div>
	


	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2013/05/17/golang-current-file-path/">
		
			Golang Current File Path</a>
	</h2>
	<div class="entry-content">
		<p>I recently needed to get the current file absolute path from a go file.
You first need to get the runtime package which is a part of Go</p>

<div class="highlight"><pre><code class="go"><span class="kn">import</span> <span class="s">&quot;runtime&quot;</span></code></pre></div>

<p>Next you can use the <code>Caller</code> method and capture the filename. We need to
give this function a <code>1</code> to tell it to skip up a caller. You can read more
about the function <a href="http://golang.org/pkg/runtime/#Caller">here</a></p>

<div class="highlight"><pre><code class="go"><span class="nx">_</span><span class="p">,</span> <span class="nx">filename</span><span class="p">,</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">runtime</span><span class="p">.</span><span class="nx">Caller</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></code></pre></div>

<p>The filename will be the path up to the current directory of the file that
calls this function. The <code>ok</code> is to check if the function call was able to
find the information requested.</p>

<p>So in practice if you wanted to get a config file up a directory and in a
config directory you could do the following</p>

<div class="highlight"><pre><code class="go"><span class="nx">filepath</span> <span class="o">:=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">Join</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">Dir</span><span class="p">(</span><span class="nx">filename</span><span class="p">),</span> <span class="s">&quot;../config/settings.toml&quot;</span><span class="p">)</span></code></pre></div>


		
		
	</div>


<div class="meta">
	<div class="date">








<time datetime="May 17, 2013" pubdate data-updated="true">May 17, 2013</time>


</div>
	


	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2013/03/26/rubymotion-custom-fonts/">
		
			Rubymotion Custom Fonts</a>
	</h2>
	<div class="entry-content">
		<p>In your Rakefile add your font in the app setup.</p>

<div class="highlight"><pre><code class="ruby"><span class="no">Motion</span><span class="o">::</span><span class="no">Project</span><span class="o">::</span><span class="no">App</span><span class="o">.</span><span class="n">setup</span> <span class="k">do</span> <span class="o">|</span><span class="n">app</span><span class="o">|</span>
  <span class="c1"># App Settings</span>
  <span class="n">app</span><span class="o">.</span><span class="n">fonts</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;st-marie.ttf&#39;</span><span class="o">]</span>
<span class="k">end</span></code></pre></div>

<p>Make sure your st-marie.ttf is in your resources directory</p>

<p>To use in your app do the following</p>

<div class="highlight"><pre><code class="ruby"><span class="n">my_font</span> <span class="o">=</span> <span class="no">UIFont</span><span class="o">.</span><span class="n">fontWithName</span> <span class="s1">&#39;St Marie&#39;</span><span class="p">,</span> <span class="ss">size</span><span class="p">:</span> <span class="mi">32</span></code></pre></div>

<p>To find your font family name</p>

<div class="highlight"><pre><code class="ruby"><span class="no">UIFont</span><span class="o">.</span><span class="n">familyNames</span><span class="o">.</span><span class="n">sort</span> <span class="c1"># Should contain &#39;St Marie&#39;</span></code></pre></div>

<p>To find the font names for a family name</p>

<div class="highlight"><pre><code class="ruby"><span class="c1"># Returns array of font names for &#39;St Marie&#39;</span>
<span class="no">UIFont</span><span class="o">.</span><span class="n">fontNamesForFamilyName</span> <span class="s1">&#39;St Marie&#39;</span></code></pre></div>


		
		
	</div>


<div class="meta">
	<div class="date">








<time datetime="Mar 26, 2013" pubdate data-updated="true">Mar 26, 2013</time>


</div>
	


	
</div></article>

<nav id="pagenavi">
    
    
    <div class="center"><a href="/archives">Blog Archives</a></div>
</nav></div>
	<footer id="footer" class="inner">Copyright &copy; 2015

    El Chavo

<br>
</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'el-chavez';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>






<script src="/javascripts/highlight.pack.js"></script>
<script type="text/javascript">
$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
</script>

</body>
</html>
